var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){t.appendChild(e)}function s(t,e,n){t.insertBefore(e,n||null)}function c(t){t.parentNode.removeChild(t)}function i(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(){return u(" ")}function f(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function p(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}let m;function b(t){m=t}function h(t){(function(){if(!m)throw new Error("Function called outside component initialization");return m})().$$.on_mount.push(t)}const g=[],k=Promise.resolve();let y=!1;const v=[],w=[],x=[];function $(t){w.push(t)}function q(){const t=new Set;do{for(;g.length;){const t=g.shift();b(t),_(t.$$)}for(;v.length;)v.shift()();for(;w.length;){const e=w.pop();t.has(e)||(e(),t.add(e))}}while(g.length);for(;x.length;)x.pop()();y=!1}function _(t){t.fragment&&(t.update(t.dirty),o(t.before_render),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_render.forEach($))}const A=new Set;function B(t,e){t.$$.dirty||(g.push(t),y||(y=!0,k.then(q)),t.$$.dirty=n()),t.$$.dirty[e]=!0}function N(l,a,s,c,i,u){const d=m;b(l);const f=a.props||{},p=l.$$={fragment:null,ctx:null,props:u,update:t,not_equal:i,bound:n(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(d?d.$$.context:[]),callbacks:n(),dirty:null};let h=!1;var g,k,y;p.ctx=s?s(l,f,(t,e)=>{p.ctx&&i(p.ctx[t],p.ctx[t]=e)&&(p.bound[t]&&p.bound[t](e),h&&B(l,t))}):f,p.update(),h=!0,o(p.before_render),p.fragment=c(p.ctx),a.target&&(a.hydrate?p.fragment.l((y=a.target,Array.from(y.childNodes))):p.fragment.c(),a.intro&&((g=l.$$.fragment)&&g.i&&(A.delete(g),g.i(k))),function(t,n,l){const{fragment:a,on_mount:s,on_destroy:c,after_render:i}=t.$$;a.m(n,l),$(()=>{const n=s.map(e).filter(r);c?c.push(...n):o(n),t.$$.on_mount=[]}),i.forEach($)}(l,a.target,a.anchor),q()),b(d)}class S{$destroy(){var e,n;n=1,(e=this).$$.fragment&&(o(e.$$.on_destroy),n&&e.$$.fragment.d(1),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}const E={getCurrentUser:"/wp-node/auth/user",getUserBookmarks:"/wp-node/bookmark/getUserBookmarks",manageUserBookmark:"/wp-node/bookmark/manageUserBookmark",manageUserMark:"/wp-node/mark/manageUserMark",getUserMarks:"/wp-node/mark/getUserMarks",getPostBookmarks:"/wp-node/bookmark/getPostBookmarks",getAllBookmarks:"/wp-node/bookmark/getAll"};const C=async t=>{try{const e=await fetch(t);return await e.json()}catch(t){throw console.log(t),t}};function U(e,n=t){let o;const r=[];function a(t){if(l(e,t)){if(e=t,!o)return;r.forEach(t=>t[1]()),r.forEach(t=>t[0](e))}}return{set:a,update:function(t){a(t(e))},subscribe:function(l,s=t){const c=[l,s];return r.push(c),1===r.length&&(o=n(a)||t),l(e),()=>{const t=r.indexOf(c);-1!==t&&r.splice(t,1),0===r.length&&o()}}}}const j=U(null),I=U([]),T=U(0);let M,P="icon-bookmark-empty hoverable post-bookmark-icon post-bookmark",L="icon-bookmark hoverable post-bookmark-icon post-bookmark colored";I.subscribe(t=>{M=t});const O=(t=null)=>{return t?t.querySelector(".post-bookmark"):document.querySelector(".post-bookmark")},z=async(t,e=!1)=>{let n=0;if(e)M.map(e=>{e.post===+t&&(n+=1)});else{const e=await(async t=>await C(`${E.getPostBookmarks}?post=${t}`))(t);n=e.length}return n},F=(t,e=null)=>{let n=O(e);if(n){let e=Number.parseInt(n.textContent)+t;n.textContent=e>0?e.toString():""}},H=(t=!0,e=!1,n=!1,o=null)=>{if(e&&"true"!==localStorage.getItem("isBookmark"))return;let r=O(o);if(r){let e=L,l="Убрать из закладок";t||(e=P,l="Добавить в закладки",F(-1,o)),r.className=e,r.setAttribute("title",l),n&&((t=null)=>{let e=O(t);e&&e.click()})(o)}},W=async(t=null,e=!0)=>{let n=O(t);if(n){let t=n.attributes["data-post"];if(t){let o=t.value;if(o)try{let t=await z(o,e);n.textContent=t>0?`${t}`:""}catch(t){}}}},D=async(t,e=null)=>{const n=t.target.getAttribute("data-post");let o=await(t=>C(`${E.manageUserBookmark}?post=${t}`))(n);H(1!==o,!1,!1,e),((t,e)=>{let n=1!==t?"bookmark":"unbookmark";fetch("https://rstat.tproger.ru/wh/post",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({post_id:e,event_type:n})})})(o,n),W(e,!1)};function G(t){return null!=t&&""!==t}function J(){return function(t){try{var e=" "+document.cookie,n=e.split(" "+t+"=");if(2==n.length)return n.pop().split("").shift()}catch(t){return""}}("jwt")}function R(t){return new Promise(e=>setTimeout(()=>{console.log(`pause ${t} is over`),e()},1500))}function Y(t){return function(t){return document.getElementById(t)}(t)}let K;T.subscribe(t=>{K=t});const Q=()=>document.querySelectorAll("article")[K];let V;j.subscribe(t=>{V=t}),T.subscribe(t=>{});let X=!1,Z=".pre-modal-container",tt=".pre-modal-cover";const et=()=>(localStorage.removeItem("isBookmark"),null);function nt(){try{let t=document.querySelector(Z),e=document.querySelector(tt),n=Q();window.onbeforeunload=et,t&&e&&(X?(t.style.display="none",e.style.display="none",X=!1,G(V)?H(!0,!0,!0,n):H(!1,!1,!1,n)):(t.style.display="flex",e.style.display="block",X=!0,H(!0,!0,!1,n)))}catch(t){}}let ot="tproger.ru/personal",rt="tproger.ru/best-it-media-2019-user-voting";function lt(t){if(window.location.href.includes(ot)){var e=document.getElementById("restarter");e&&e.click()}var n,o;n="body",o=t.theme,document.querySelector(n).classList.add(o)}function at(t){var e;e="/jobs",document.location.href.includes(e)&&!window.setDataFromPersonalArea&&(window.setDataFromPersonalArea=(()=>{Y("candidate_name").value=t.name,Y("candidate_link").value=t.resume,Y("candidate_phone").value=t.contact,Y("candidate_email").value=t.email}),document.getElementById("login-profile-link").style.display="block")}const st=async(t,e=null,n)=>{let o=O(e);if(o)if(G(t)){let n=(t=>{let e=null,n=t.attributes["data-post"];if(n){let t=n.value;t&&(e=t)}return e})(o);if(n)((t,e)=>{let n=!1;return M.map(o=>{o.post==t&&o.user===e&&(n=!0)}),n})(n,t.id)?(o.className=L,o.setAttribute("selected","true"),o.setAttribute("title","Убрать из закладок")):(o.className=P,o.setAttribute("selected","false"),o.setAttribute("title","Добавить в закладки")),o.onclick=(t=>{D(t,e)})}else o.className=P,o.setAttribute("selected","false"),o.setAttribute("title","Добавить в закладки"),o.onclick=(async t=>{localStorage.setItem("isBookmark","true"),F(1,e),H(!0,!1,!1,e),T.set(n),nt()})},ct=async t=>{I.set(await(async()=>await C(`${E.getAllBookmarks}`))());let e=document.querySelectorAll("article");if(e&&e.length>0){let n=0;e.forEach(e=>{st(t,e,n),W(e),n+=1})}};let it;j.subscribe(t=>{it=t});let ut=!1;const dt=30;let ft="/personal/#",pt="resizable=yes, scrollbars=yes, titlebar=yes, width=auto, height=auto";const mt=async(t=!1)=>{let e=!1,n=null;if(t){const t=J();try{G(t)&&(n=function(t){try{return JSON.parse(atob(t.split(".")[1]))}catch(t){return null}}(t).data,e=!0)}catch(t){e=!1}}e||(n=await async function(){return await fetch(E.getCurrentUser).then(t=>t.json()).catch(t=>null)}()),j.set(n)},bt=async()=>{await mt(!0),G(it)&&G(it.id)||await mt(),G(it)&&(lt(it),function(){if(window.location.href.includes(rt)){var t=document.getElementById("restarter");t&&t.click()}}(),at(it)),ct(it),ht(it)};function ht(t){try{var e=document.getElementById("user-icon");e&&(G(t)?(ut=!0,e.setAttribute("href","/personal"),e.setAttribute("onclick",""),e.innerHTML=`<img class='round-image' src='${t.photo}' alt='Личный кабинет'>`,!0===X&&nt()):(e.setAttribute("href","#"),e.setAttribute("onclick","openAuthWindow()"),e.innerHTML="<img src='/wp-content/themes/bliss/assets/img/icon-user.svg'>\n          \t<span class='hide-on-mobile'>Войти</span>"))}catch(t){console.log("Can not update icon")}}var gt;!function(t){t.loginWindowCloseButton="auth-modal-close"}(gt||(gt={}));var kt=gt;function yt(t,e,n){const o=Object.create(t);return o.button=e[n],o}function vt(t){for(var e,n,o,r=t.settings,l=[],u=0;u<r.length;u+=1)l[u]=wt(yt(t,r,u));return{c(){e=i("div");for(var t=0;t<l.length;t+=1)l[t].c();n=d(),p(o=i("p"),"class","footer svelte-7u9qbo"),p(e,"class","modal-buttons svelte-7u9qbo")},m(r,c){s(r,e,c);for(var i=0;i<l.length;i+=1)l[i].m(e,null);a(e,n),a(e,o),o.innerHTML=t.footerText},p(t,o){if(t.settings){r=o.settings;for(var a=0;a<r.length;a+=1){const s=yt(o,r,a);l[a]?l[a].p(t,s):(l[a]=wt(s),l[a].c(),l[a].m(e,n))}for(;a<l.length;a+=1)l[a].d(1);l.length=r.length}},d(t){t&&c(e),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(l,t)}}}function wt(t){var e,n,o,r,l=t.button.text;function d(){return t.click_handler(t)}return{c(){e=i("span"),n=i("span"),o=u(l),p(n,"class","svelte-7u9qbo"),p(e,"class",t.button.className+" svelte-7u9qbo"),r=f(e,"click",d)},m(t,r){s(t,e,r),a(e,n),a(n,o)},p(e,n){t=n},d(t){t&&c(e),r()}}}function xt(e){var n,r,l,u,m,b,h=void 0!==e.settings&&null!==e.settings&&vt(e);return{c(){n=i("div"),r=d(),l=i("div"),u=i("div"),m=d(),h&&h.c(),p(n,"class","pre-modal-cover svelte-7u9qbo"),p(u,"id",kt.loginWindowCloseButton),p(u,"class","close-post icon-close"),p(l,"align","center"),p(l,"class","pre-modal-container box svelte-7u9qbo"),b=[f(n,"click",nt),f(u,"click",nt)]},m(t,e){s(t,n,e),s(t,r,e),s(t,l,e),a(l,u),a(l,m),h&&h.m(l,null)},p(t,e){void 0!==e.settings&&null!==e.settings?h?h.p(t,e):((h=vt(e)).c(),h.m(l,null)):h&&(h.d(1),h=null)},i:t,o:t,d(t){t&&(c(n),c(r),c(l)),h&&h.d(),o(b)}}}async function $t(){await bt()}function qt(t){let e=[{enabled:!0,href:"/wp-node/auth/vkontakte",text:"ВКонтакте",className:"btn icon-vkontakte colored"},{enabled:!0,href:"/wp-node/auth/github",text:"GitHub",className:"btn icon-github-circled-alt2 colored"},{enabled:!0,href:"/wp-node/auth/facebook",text:"Facebook",className:"btn icon-facebook colored"},{enabled:!0,href:"/wp-node/auth/twitter",text:"Twitter",className:"btn icon-twitter colored"},{enabled:!0,href:"/wp-node/auth/google",text:"Google",className:"btn icon-google colored"},{enabled:!0,href:"/wp-node/auth/yandex",text:"Yandex",className:"btn icon-yandex colored"}];return h($t),{footerText:' Авторизуясь, вы соглашаетесь с\n      <a href="https://tproger.ru/wp-content/uploads/custom/terms_v1.pdf">\n        правилами пользования сайтом\n      </a>\n      и даете\n      <a href="https://tproger.ru/wp-content/uploads/custom/privacy_v1.pdf">\n        согласие на обработку персональных данных</a>.',settings:e,click_handler:function({button:t}){return async function(t){var e=window.open(t,"_blank",pt);e.onbeforeunload=(()=>{ht(j)});let n=0;for(;!0!==ut&&n!==dt;)await R(n),n++,bt();e.onhashchange=(t=>{t.newURL.includes(ft)&&(e.close(),ut=!0,bt())}),e.onload=(()=>{e.location.href.includes(ft)&&(e.close(),ut=!0,bt())})}(t.href)}}}return new class extends S{constructor(t){var e;super(),document.getElementById("svelte-7u9qbo-style")||((e=i("style")).id="svelte-7u9qbo-style",e.textContent=".telegram.svelte-7u9qbo{display:none}.pre-modal-cover.svelte-7u9qbo,.pre-modal-container.svelte-7u9qbo{display:none}.modal-buttons.svelte-7u9qbo{display:flex;flex-wrap:wrap;align-items:center}.pre-modal-cover.svelte-7u9qbo{position:fixed;left:0;top:0;z-index:900;background-color:#ccc;opacity:0.5;overflow:hidden}.pre-modal-container.svelte-7u9qbo{z-index:900;position:fixed;top:calc((100vh - 470px) / 2);left:calc((100vw - 350px) / 2);width:350px;height:470px;flex-wrap:wrap;justify-content:flex-end}.modal-buttons.svelte-7u9qbo{justify-content:center}.modal-buttons.svelte-7u9qbo,.pre-modal-cover.svelte-7u9qbo{width:100%}.btn.svelte-7u9qbo{margin:8px;width:290px;border:1px solid #ededed;border-radius:5px;font-size:16px;line-height:2;cursor:pointer}.btn.svelte-7u9qbo:hover{border-color:#ccc;transition:0.5s}.disabled.svelte-7u9qbo{color:gray !important;cursor:default;pointer-events:none}span.svelte-7u9qbo{display:inline-block;color:#2b2a29;width:calc(100% - 50px)}.modal-icon.svelte-7u9qbo{width:30px;height:30px}.pre-modal-cover.svelte-7u9qbo{height:100%}.footer.svelte-7u9qbo{text-align:left;padding:10px 20px 0px 30px;line-height:1.6}.flex.svelte-7u9qbo{display:flex}",a(document.head,e)),N(this,t,qt,xt,l,[])}}({target:document.querySelector("#tproger-login")})}();